# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§â€â™‚ï¸ DW Project - Automated Security Scanning System
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Scan Frequency: Every Hour | Security Level: MAXIMUM
# Auto-Detection: Secrets, Vulnerabilities, Malware, Compliance
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: ğŸ›¡ï¸ Hourly Security Scan

on:
  # Ø§Ù„ØªÙØªÙŠØ´ ÙƒÙ„ Ø³Ø§Ø¹Ø©
  schedule:
    - cron: '0 * * * *'  # ÙƒÙ„ Ø³Ø§Ø¹Ø© ÙÙŠ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© 0
  
  # Ø§Ù„ØªÙØªÙŠØ´ Ø¹Ù†Ø¯ ÙƒÙ„ Push
  push:
    branches: [ main, master, develop ]
  
  # Ø§Ù„ØªÙØªÙŠØ´ Ø¹Ù†Ø¯ ÙƒÙ„ Pull Request
  pull_request:
    branches: [ main, master, develop ]
  
  # Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
  workflow_dispatch:

# ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø­Ø¯ÙˆØ¯Ø© Ù„Ù„Ø£Ù…Ø§Ù†
permissions:
  contents: read
  security-events: write
  issues: write
  pull-requests: write

jobs:
  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ ğŸ” SCAN 1: SECRET DETECTION                                â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  secret-scan:
    name: ğŸ” Detect Secrets & Credentials
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ÙØ­Øµ ÙƒØ§Ù…Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ®
      
      - name: ğŸ” TruffleHog Secret Scan
        uses: trufflesecurity/trufflehog@main
        with:
          extra_args: --only-verified --json
      
      - name: ğŸ” Gitleaks Secret Detection
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ğŸš¨ Report Secrets Found
        if: failure()
        run: |
          echo "ğŸš¨ CRITICAL: Secrets detected in repository!"
          echo "âš ï¸ Immediate action required!"
          exit 1

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ ğŸ›¡ï¸ SCAN 2: DEPENDENCY VULNERABILITIES                      â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  dependency-scan:
    name: ğŸ“¦ Scan Dependencies
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: ğŸ” NPM Audit
        if: hashFiles('package.json') != ''
        run: |
          npm audit --audit-level=moderate || echo "âš ï¸ Vulnerabilities found"
      
      - name: ğŸ” Python Safety Check
        if: hashFiles('requirements.txt') != ''
        run: |
          pip install safety
          safety check --json || echo "âš ï¸ Python vulnerabilities found"
      
      - name: ğŸ›¡ï¸ Snyk Security Scan
        uses: snyk/actions/node@master
        continue-on-error: true
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ ğŸ” SCAN 3: CODE SECURITY ANALYSIS                          â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  code-scan:
    name: ğŸ’» Static Code Analysis
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ğŸ” CodeQL Analysis
        uses: github/codeql-action/init@v3
        with:
          languages: javascript, python
      
      - name: ğŸ—ï¸ Autobuild
        uses: github/codeql-action/autobuild@v3
      
      - name: ğŸ” Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v3
      
      - name: ğŸ›¡ï¸ Semgrep Security Scan
        uses: returntocorp/semgrep-action@v1
        with:
          config: >-
            p/security-audit
            p/secrets
            p/owasp-top-ten

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ ğŸ¦  SCAN 4: MALWARE DETECTION                               â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  malware-scan:
    name: ğŸ¦  Malware & Virus Detection
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: ğŸ” ClamAV Scan
        run: |
          sudo apt-get update
          sudo apt-get install -y clamav clamav-daemon
          sudo freshclam
          clamscan -r --bell -i . || echo "âš ï¸ Potential threats found"
      
      - name: ğŸ›¡ï¸ YARA Rules Scan
        run: |
          sudo apt-get install -y yara
          echo "ğŸ” Scanning with YARA rules..."
          # ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‚ÙˆØ§Ø¹Ø¯ YARA Ù…Ø®ØµØµØ© Ù‡Ù†Ø§

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ ğŸ”’ SCAN 5: DOCKER SECURITY                                 â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  docker-scan:
    name: ğŸ³ Docker Image Security
    runs-on: ubuntu-latest
    if: hashFiles('Dockerfile') != ''
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: ğŸ” Trivy Container Scan
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'fs'
          scan-ref: '.'
          format: 'sarif'
          output: 'trivy-results.sarif'
      
      - name: ğŸ“¤ Upload Trivy Results
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: 'trivy-results.sarif'

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ ğŸ“Š SCAN 6: COMPLIANCE CHECK                                â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  compliance-scan:
    name: âœ… Security Compliance
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: ğŸ” Check Security Policies
        run: |
          echo "ğŸ” Checking security policies..."
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
          FILES=("SECURITY.md" "LICENSE" ".gitignore")
          for file in "${FILES[@]}"; do
            if [ ! -f "$file" ]; then
              echo "âš ï¸ Missing required file: $file"
            else
              echo "âœ… Found: $file"
            fi
          done
      
      - name: ğŸ”’ Check File Permissions
        run: |
          echo "ğŸ” Checking file permissions..."
          find . -type f -perm /o+w -not -path "./.git/*" || echo "âœ… No world-writable files"
      
      - name: ğŸ“ Check Git History
        run: |
          echo "ğŸ” Scanning git history for sensitive patterns..."
          git log --all --full-history --pretty=format:"%H %s" | \
          grep -iE "(password|secret|key|token|credential)" || \
          echo "âœ… No sensitive data in commit messages"

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ ğŸ“Š FINAL: SECURITY REPORT                                  â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  security-report:
    name: ğŸ“Š Generate Security Report
    runs-on: ubuntu-latest
    needs: [secret-scan, dependency-scan, code-scan, malware-scan, compliance-scan]
    if: always()
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: ğŸ“Š Create Security Report
        run: |
          cat << EOF > security-report.md
          # ğŸ›¡ï¸ Security Scan Report
          
          **Repository:** \${{ github.repository }}
          **Scan Date:** $(date -u +"%Y-%m-%d %H:%M:%S UTC")
          **Triggered By:** \${{ github.event_name }}
          **Branch:** \${{ github.ref_name }}
          
          ## ğŸ“‹ Scan Summary
          
          | Check | Status |
          |-------|--------|
          | ğŸ” Secret Detection | \${{ needs.secret-scan.result }} |
          | ğŸ“¦ Dependencies | \${{ needs.dependency-scan.result }} |
          | ğŸ’» Code Analysis | \${{ needs.code-scan.result }} |
          | ğŸ¦  Malware Scan | \${{ needs.malware-scan.result }} |
          | âœ… Compliance | \${{ needs.compliance-scan.result }} |
          
          ## ğŸ¯ Next Actions
          
          - Review all failed checks immediately
          - Update dependencies with vulnerabilities
          - Remove any detected secrets
          - Fix security code issues
          
          ---
          ğŸ§â€â™‚ï¸ **DW Project Security Team**
          EOF
          
          cat security-report.md
      
      - name: ğŸ’¾ Upload Security Report
        uses: actions/upload-artifact@v4
        with:
          name: security-report
          path: security-report.md
          retention-days: 90
      
      - name: ğŸš¨ Create Issue on Failure
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'ğŸš¨ Security Scan Failed - Immediate Action Required',
              body: `## ğŸ›¡ï¸ Security Alert
              
              **Time:** ${new Date().toUTCString()}
              **Workflow:** ${context.workflow}
              **Run:** ${context.runNumber}
              
              Security scan has detected issues that require immediate attention.
              
              Please review the [workflow run](${context.payload.repository.html_url}/actions/runs/${context.runId}) for details.
              
              ---
              ğŸ§â€â™‚ï¸ Automated Security System`,
              labels: ['security', 'critical', 'automated']
            })

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§â€â™‚ï¸ END OF SECURITY SCANNING WORKFLOW
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”’ This workflow runs every hour to protect your repository
# ğŸ›¡ï¸ Scans: Secrets, Dependencies, Code, Malware, Compliance
# ğŸ“Š Reports are generated and stored for 90 days
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
